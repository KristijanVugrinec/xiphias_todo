{% extends 'base.html.twig' %}

{% block title %}Todo List{% endblock %}

{% block body %}
    <h1>Todo List</h1>

    <a href="{{ path('todo_create') }}" class="btn btn-success">Create New Todo</a>

    <ul>
        {% for todo in todos %}
            <li>{{ todo.title }} - {{ todo.dueDate|date('Y-m-d H:i') }}</li>
            <p>{{todo.description}}</p>
            <button class="delete-todo-btn" data-id="{{todo.id}}">DELETE</button>
        {% else %}
            <li>No todos yet!</li>
        {% endfor %}
    </ul>
    <a href="{{ path('app_logout') }}">Odjavite se</a>

    <script>
    document.addEventListener('DOMContentLoaded',() => {
        document.querySelectorAll('.delete-todo-btn').forEach(button => {
            button.addEventListener('click',()=>{
                const todoId = button.getAttribute('data-id');
                console.log("id od todo-a",todoId)

                fetch(`/todo/${todoId}/delete`,{
                    method:'DELETE',
                    headers:{
                        'X-Requested-With':'XMLHttpRequest'
                    },
                })

                .then(response => {
                    if(response.ok){
                        alert('Todo deleted successfully');
                        location.reload()
                    } else {
                        response.json().then(data => {
                            alert(data.message || 'An error occurred')
                        })
                    }
                })
                .catch(error => {
                    console.error('Error',error)
                    alert('An error occurred while deleting the todo.')
                })
            })
        })
    })
    </script>
{% endblock %}
